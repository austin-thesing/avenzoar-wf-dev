<div id="grain"></div>

<svg xmlns="http://www.w3.org/2000/svg" style="display: none">
  <filter id="noise">
    <feTurbulence id="turb" type="fractalNoise" baseFrequency="0.8" numOctaves="2" seed="3" />
    <feColorMatrix type="saturate" values="0" />
  </filter>
</svg>

<style>
  #grain {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    filter: url(#noise);
    opacity: 0.22; /* slightly lower intensity */
    mix-blend-mode: overlay;
    pointer-events: none;
  }
</style>

<script>
  const turb = document.querySelector("#turb");

  if (!turb) {
    console.warn("[grainy-grain] #turb filter not found; grain animation disabled.");
    return;
  }

  if (!window.gsap) {
    console.warn("[grainy-grain] GSAP not available; grain animation disabled.");
    return;
  }

  const gsapInstance = window.gsap;
  const baseFrequency = 0.74;
  const jitter = 0.006;
  const seedRange = { min: 0, max: 80 };
  const changeInterval = 90;

  gsapInstance.set(turb, {
    attr: { baseFrequency },
  });

  let frameCount = 0;
  const tickerHandler = () => {
    frameCount += 1;
    if (frameCount % changeInterval === 0) {
      const nextSeed = Math.floor(gsapInstance.utils.random(seedRange.min, seedRange.max));
      const nextFrequency = baseFrequency + gsapInstance.utils.random(-jitter, jitter);

      turb.setAttribute("seed", nextSeed);
      turb.setAttribute("baseFrequency", nextFrequency.toFixed(4));
    }
  };

  gsapInstance.ticker.add(tickerHandler);
</script>
